--------------------------------------------------


Projet Malware



Groupe :



ENESCU Michael


BEAUDOUIN Nicolas


--------------------------------------------------



Objectif du document:




Ce programme a été créé afin de s'entraîner à l'offuscation de programme.


Ce document a pour objectif d'expliquer son fonction.




-------------------------------------------------



Fonctionnemment:




L'utilisateur lance le programme en donnant en entrée un nombre en hexadécimal.


Ce nombre doit être donné au format 0xA1234BCDEF, soit les lettres représentant un nombre en hexa doivent être écrites en majuscules.

Toutes les 2,3 lignes, un "IsDebuggerPresent()" est réalisé.

Dans le code sont stockées différentes chaînes de caractères sous différents formats.



Certaines chaînes de caractère non-importantes sont écrites en dur comme "At least try to play ...\n".



Les autres chaînes sont stockées sous forme de liste d'entiers au format ASCII:



Ainsi, "AH!" sera stocké sous la forme : {65, 72, 33}.



Ce mode de stockage est utilisé pour toutes les chaînes de caractères plus importantes comme "GG Champion!" et le stockage de la clé.



Pour ces chaînes importantes, elles sont stockées après avoir reçu un certain traitement.




--------------------------------------------------



Opérations de chiffrement



Afin de chiffrer les clés et la chaîne de caractère "GG Champion!", nous avons d'une part créée des fonctions de chiffrement.


et d'autre part utilisé une fonction existante de chiffrement en base 64 (https://stackoverflow.com/questions/342409/how-do-i-base64-encode-decode-in-c).


Le chiffrement en base 64 a été uniquement utilisé pour la chaîne de caractère "GG Champion", la clé a été chiffrée avec une fonction que nous avons créé.





- Chiffrement de la clé :



Ce chiffrement se réalise en 3 étapes :


- un certain enchaînement de "xor"s avec lui-même


- un mélange des "char"s de la clé


- une inversion de la valeur ASCII de certains caractères



-- Enchaînements de "xor"s




La chaîne reçue en entrée est passé en entrée de la fonction suivante :




""""



char* toHardcode = (char*) calloc(len,sizeof(char));


strcpy(toHardcode, str);



for(int i =1; i < len; i++){


for(int j = len -1; j >=i; j--){


toHardcode[j] = toHardcode[j-1] ^ toHardcode[j];


}


}



""""



Pour chaque élément de la chaîne de caractères, nous "xor"ons cet élément avec son prédécesseur en commençant avec la fin


de la chaîne et diminuant petit à petit l'élément de départ du "xor".



-- Mélange des "char"s de la clé



Nous parcourrons pour chaque élément de la chaîne de caractère :


- si son code ASCII est < 150 et que son indice est inférieur à 150, nous échangeons cet élément avec celui à la position son code ASCII.


- sinon rien



-Inversion de la valeur ASCII



Une fois que les deux opérations précédentes ont été réalisées dans cet ordre, nous convertissons la chaîne de caractère en un tableau de int


selon la méthode expliquée précédemment, soit à un caractère, nous attribuons son code ASCII.


Nous inversons ensuite les codes ASCII inférieurs à 100 de la manière suivante : "14" devient"41" puis pour chaque code ASCII, nous effectuons l'opération suivante : 1234* (code ASCII) %139.



-------------------------------------------------



Vérification :



Nous avons codé une fonction spéciale de vérification de la clé. Son action est cependant très similaire à strcmp().



Nous avions au préalable codé la valeur de la clé après toutes les opérations précédentes.



Elle était donc stockée sous la forme d'un array de int. Nous convertissons cet array en un char* et comparons avec la fonction que nous avions créé le résultat.



Au final, si le résultat est correct, nous décodons la chaîne de caractère "GG Champion!" précédement codée en base 64 et l'affichons dans le terminal.


Sinon, nous renvoyons "argv[1]".

Voici la clé en clair "0x12FE569AFEEEA3426E6EC15A998614562A72681644356792736578FAC56743567829ACEEA2567904875AEFC975BB2B3B4BACEEC2563994FA43562765ECACE67800010972BBECAAEAEAE1558902887551356894091276447890"


